(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5818"],{"22Rr":function(e,t,n){"use strict";var i=n("CEud");n.n(i).a},"6R3Q":function(e,t,n){"use strict";var i={name:"Reminder",components:{},props:{content:{type:String,default:"Nội dung"},fontSize:{type:String,default:"13"}},data:function(){return{}},computed:{},mounted:function(){},destroyed:function(){},methods:{}},l=(n("PG71"),n("KHd+")),o=Object(l.a)(i,function(){var e=this.$createElement,t=this._self._c||e;return t("flexbox",{staticClass:"reminder-wrapper"},[t("flexbox",{staticClass:"reminder-body",attrs:{align:"stretch"}},[t("i",{staticClass:"wukong wukong-reminder reminder-icon"}),this._v(" "),t("div",{staticClass:"reminder-content",style:{"font-size":this.fontSize+"px"}},[this._v("\n      "+this._s(this.content)+"\n    ")])])],1)},[],!1,null,"53525604",null);o.options.__file="reminder.vue";t.a=o.exports},CEud:function(e,t,n){},IDwW:function(e,t,n){"use strict";n.r(t);var i=n("sGAf"),l={name:"RelateEmpoyee",components:{XhUserCell:n("8GhS").p},mixins:[],props:{visible:{type:Boolean,required:!0,default:!1},roleId:[Number,String]},data:function(){return{loading:!0,selectUsers:[]}},computed:{},watch:{visible:function(e){e&&(this.selectUsers=[])}},mounted:function(){},methods:{handleCancel:function(){this.$emit("update:visible",!1)},changeCheckout:function(e){this.selectUsers=e.value},handleConfirm:function(){var e=this;0==this.selectUsers.length?this.$message.error("Vui lòng chọn một nhân viên"):Object(i.j)({userIds:this.selectUsers.map(function(e){return e.userId}).join(","),roleIds:this.roleId}).then(function(t){e.$message.success("Thành công"),e.$emit("save")}).catch(function(){})}}},o=(n("22Rr"),n("KHd+")),s=Object(o.a)(l,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.visible,"append-to-body":!0,title:"Nhân viên liên quan",width:"600px"},on:{close:e.handleCancel}},[n("div",{staticClass:"handle-box"},[n("flexbox",{staticClass:"handle-item",attrs:{align:"stretch"}},[n("div",{staticClass:"handle-item-name",staticStyle:{"margin-top":"8px"}},[e._v("Chọn nhân viên:")]),e._v(" "),n("xh-user-cell",{staticClass:"handle-item-content",attrs:{radio:!1,value:e.selectUsers},on:{"value-change":e.changeCheckout}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("Hủy")]),e._v(" "),n("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.handleConfirm(t)}}},[e._v("OK")])],1)])},[],!1,null,"37916c08",null);s.options.__file="relateEmpoyee.vue";var a=s.exports,r=n("KTTK"),c={components:{RelateEmpoyee:a,Reminder:n("6R3Q").a},data:function(){return{pid:"",title:"",tableData:[],tableHeight:document.documentElement.clientHeight-305,treeHeight:document.documentElement.clientHeight-230,currentPage:1,pageSize:15,pageSizes:[15,30,45,60],total:0,tableList:[{label:"Họ và tên",field:"realname"},{label:"Tên phòng ban",field:"deptName"},{label:"Bài đăng",field:"post"},{label:"Tên vai trò",field:"roleName"}],newRoleVisible:!1,role:{},roleList:[],mainMenuIndex:"user",ruleMenuIndex:"data",ruleMenuList:[],defaultProps:{children:"childMenu",label:"menuName"},relateEmpoyeeShow:!1,roleActive:null,dropdownHandleRole:null,roleTitle:"",roleMenuLoading:!1,ruleLoading:!1,userLoading:!1}},computed:{roleId:function(){return this.roleActive?this.roleActive.roleId:""},showRuleSet:function(){return!!this.roleActive&&("admin"!=this.roleActive.remark&&"project"!=this.roleActive.remark)},showReminder:function(){return!!this.roleActive&&"project"==this.roleActive.remark}},watch:{},mounted:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-305,e.treeHeight=document.documentElement.clientHeight-230},this.pid=this.$route.params.pid,this.title=this.$route.params.title,this.getRulesList(),this.getRoleList()},beforeRouteUpdate:function(e,t,n){this.pid=e.params.pid,this.title=e.params.title,this.roleActive=null,this.roleList=[],this.currentPage=1,this.total=0,this.tableData=[],this.getRulesList(),this.getRoleList(),n()},methods:{getRulesList:function(){var e=this;Object(i.g)({roleType:this.pid}).then(function(t){t.data.data?(e.ruleMenuList=[{label:"Chức năng",index:"data",type:"tree",value:[],data:[t.data.data]}],t.data.bi&&e.ruleMenuList.push({label:"Phân tích dữ liệu",index:"bi",type:"tree",value:[],data:[t.data.bi]})):e.ruleMenuList=[],e.getRoleRulesInfo()})},getRoleList:function(){var e=this;this.roleMenuLoading=!0,Object(i.f)({roleType:this.pid}).then(function(t){e.roleList=t.data;var n=!1;if(e.roleActive)for(var i=0;i<e.roleList.length;i++){var l=e.roleList[i];if(l.roleId==e.roleActive.roleId){e.roleActive=l,e.getRoleRulesInfo(),n=!0;break}}!n&&e.roleList.length&&(e.roleActive=e.roleList[0],e.getRoleRulesInfo()),e.getUserList(e.roleActive),e.roleMenuLoading=!1}).catch(function(){e.roleMenuLoading=!1})},addEmployees:function(){this.relateEmpoyeeShow=!0},employeesSave:function(e){this.relateEmpoyeeShow=!1,this.getUserList(this.roleActive)},delectEmployees:function(e){var t=this;this.$confirm("Xác nhận xóa nhân viên vĩnh viễn?","Thông tin",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(function(){t.userLoading=!0,Object(i.i)({userId:e.userId,roleId:t.roleActive.roleId}).then(function(e){t.userLoading=!0,t.getUserList(t.roleActive),t.$message.success("Thành công")})}).catch(function(){t.$message({type:"info",message:"Không thành công"})})},newRoleClose:function(){this.newRoleVisible=!1},newRoleBtn:function(){this.roleTitle="Vai trò mới",this.newRoleVisible=!0,this.role={}},roleDropdownClick:function(e){this.dropdownHandleRole=e},roleHandleClick:function(e){"edit"==e?this.roleEditBtn(this.dropdownHandleRole):"copy"==e?this.ticketsBtn(this.dropdownHandleRole):"delete"==e&&this.roleDelect(this.dropdownHandleRole)},getReminderContent:function(){return this.roleActive&&"project"==this.roleActive.remark?'Quản trị viên dự án có tất cả các quyền của mô-đun "Quản lý dự án", có thể xem và chỉnh sửa tất cả thông tin dự án':""},roleEditBtn:function(e){this.roleTitle="Chỉnh sửa vai trò",this.role={title:e.roleName,pid:e.roleType,id:e.roleId},this.newRoleVisible=!0},ticketsBtn:function(e){var t=this;this.$confirm("Xác nhận hành động?","Thông báo",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(function(){Object(i.c)({roleId:e.roleId}).then(function(e){t.$message.success("Thành công"),t.getRoleList()})}).catch(function(){t.$message({type:"info",message:"Không thành công"})})},roleDelect:function(e){var t=this;this.$confirm("Xóa vĩnh viễn, xác nhận thực hiện?","Thông báo",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(function(){Object(i.d)({roleId:e.roleId}).then(function(e){t.roleList.length&&(t.roleActive=t.roleList[0],t.getRoleRulesInfo()),t.getRoleList(),t.$message.success("Thành công")})}).catch(function(){t.$message({type:"info",message:"Không thành công"})})},newRoleSubmit:function(){var e=this;this.role.title?"Tạo mới vai trò"==this.roleTitle?Object(i.b)({roleName:this.role.title,roleType:this.pid}).then(function(t){e.getRoleList(),e.$message.success("Thảnh công"),e.newRoleClose()}):Object(i.e)({roleName:this.role.title,roleType:this.role.pid,roleId:this.role.id}).then(function(t){e.getRoleList(),e.$message.success("Thành công"),e.newRoleClose()}):this.$message.error("Không được để trống tên vai trò")},roleMenuSelect:function(e){this.roleActive=e,"rule"!=this.mainMenuIndex||this.showRuleSet||(this.mainMenuIndex="user"),this.getRoleRulesInfo(),this.getUserList(this.roleActive)},getRoleRulesInfo:function(){var e=this;if(this.roleActive&&this.ruleMenuList.length){if(2==this.pid)"data"!=this.ruleMenuList[this.ruleMenuList.length-1].type&&this.ruleMenuList.push({label:"Quyền dữ liệu",index:"info",type:"data",value:this.roleActive.dataType});for(var t=function(t){var n=e.ruleMenuList[t];"tree"==n.type?(n.rules=e.getRoleRules(e.roleActive.rules[n.index],n.data[0]),e.$nextTick(function(){var t=e.$refs["tree"+n.index];t&&("[object Array]"==Object.prototype.toString.call(t)?t.length&&t[0].setCheckedKeys(n.rules):t.setCheckedKeys(n.rules))})):n.value=e.roleActive.dataType},n=0;n<this.ruleMenuList.length;n++)t(n)}},getRoleRules:function(e,t){e||(e=[]);for(var n=!1,i=this.copyItem(e),l=0;l<t.childMenu.length;l++){var o=t.childMenu[l];if(!o.hasOwnProperty("children"))return o.length+1!=i.length&&this.removeItem(i,t.id),i;for(var s=0;s<e.length;s++){for(var a=e[s],r=[],c=0;c<o.childMenu.length;c++){var u=o.childMenu[c];u.id==a&&r.push(u)}r.length!=o.childMenu.length&&(n=!0,this.removeItem(i,o.id))}}n&&this.removeItem(i,t.id);for(var d=[],h=0;h<i.length;h++){var v=i[h];v&&d.push(parseInt(v))}return d},copyItem:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},removeItem:function(e,t){for(var n=-1,i=0;i<e.length;i++)if(t==e[i]){n=i;break}n>0&&e.splice(n,1)},containItem:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n])return!0;return!1},getUserList:function(e,t){var n=this;e&&(t||(this.currentPage=1),this.userLoading=!0,Object(r.j)({page:this.currentPage,limit:this.pageSize,roleId:e.roleId}).then(function(e){n.tableData=e.data.list,n.total=e.data.totalRow,n.userLoading=!1}).catch(function(){n.userLoading=!1}))},handleSizeChange:function(e){this.pageSize=e,this.getUserList(this.roleActive,!0)},handleCurrentChange:function(e){this.currentPage=e,this.getUserList(this.roleActive,!0)},ruleSubmit:function(){var e=this;this.ruleLoading=!0;for(var t=[],n="",l=0;l<this.ruleMenuList.length;l++){var o=this.ruleMenuList[l];if("tree"==o.type){var s=this.$refs["tree"+o.index];s&&(t="[object Array]"==Object.prototype.toString.call(s)?t.concat(s[0].getCheckedKeys()):t.concat(s.getCheckedKeys()))}else n=o.value}Object(i.h)({rules:t,type:n,id:this.roleActive.roleId,roleName:this.roleActive.roleName}).then(function(t){e.getRoleList(),e.$message.success("Thành công"),e.ruleLoading=!1}).catch(function(){e.ruleLoading=!1})}}},u=(n("mdMS"),Object(o.a)(c,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"role-authorization"},[n("p",{ref:"title",staticClass:"title"},[e._v(" "+e._s(e.title)+" ")]),e._v(" "),n("div",{staticClass:"role-box"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.roleMenuLoading,expression:"roleMenuLoading"}],staticClass:"nav"},[n("div",{staticClass:"nav-new-btn"},[n("el-button",{attrs:{size:"medium"},on:{click:e.newRoleBtn}},[e._v(" Thêm vai trò ")])],1),e._v(" "),n("div",{staticClass:"role-nav-box"},e._l(e.roleList,function(t,i){return n("div",{key:i,staticClass:"item-list",class:{"item-list-hover":t.roleId==e.roleActive.roleId},on:{click:function(n){e.roleMenuSelect(t)}}},[e._v("\n          "+e._s(t.roleName)+"\n          "),"admin"!=t.remark&&"project"!=t.remark?n("div",{staticClass:"icon-close"},[n("el-dropdown",{attrs:{trigger:"click"},on:{command:e.roleHandleClick}},[n("i",{staticClass:"el-icon-arrow-down",on:{click:function(n){e.roleDropdownClick(t)}}}),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"copy"}},[e._v("Sao chép")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"edit"}},[e._v("Chỉnh sửa")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"delete"}},[e._v("Xóa")])],1)],1)],1):e._e()])}))]),e._v(" "),n("el-dialog",{attrs:{title:e.roleTitle,visible:e.newRoleVisible,"before-close":e.newRoleClose,width:"30%"},on:{"update:visible":function(t){e.newRoleVisible=t}}},[n("label",{staticClass:"label-title"},[e._v("Tên vai trò")]),e._v(" "),n("el-input",{staticClass:"input-role",model:{value:e.role.title,callback:function(t){e.$set(e.role,"title",t)},expression:"role.title"}}),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.newRoleSubmit}},[e._v("Lưu")]),e._v(" "),n("el-button",{on:{click:e.newRoleClose}},[e._v("Đóng")])],1)],1),e._v(" "),n("div",{staticClass:"content-box"},[n("el-tabs",{model:{value:e.mainMenuIndex,callback:function(t){e.mainMenuIndex=t},expression:"mainMenuIndex"}},[n("el-tab-pane",{attrs:{label:"Nhân viên",name:"user"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.userLoading,expression:"userLoading"}],staticClass:"content-table"},[n("flexbox",{staticClass:"content-table-header"},[n("div",{staticClass:"content-table-header-reminder"},[e.showReminder?n("reminder",{attrs:{content:e.getReminderContent()}}):e._e()],1),e._v(" "),n("el-button",{attrs:{size:"medium",type:"primary"},on:{click:e.addEmployees}},[e._v(" Thêm nhân viên ")])],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:e.tableHeight}},[e._l(e.tableList,function(t,i){return n("el-table-column",{key:i,attrs:{prop:t.field,label:t.label,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"header",fn:function(t){return[n("div",{staticClass:"table-head-name"},[e._v(e._s(t.column.label))])]}}])})}),e._v(" "),n("el-table-column",{attrs:{label:"Tùy chỉnh"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticClass:"el-icon-delete content-table-span",on:{click:function(n){e.delectEmployees(t.row)}}})]}}])})],2),e._v(" "),n("div",{staticClass:"p-contianer"},[n("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),e.roleActive&&e.showRuleSet?n("el-tab-pane",{attrs:{label:"Quyền của vai trò",name:"rule"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.ruleLoading,expression:"ruleLoading"}],staticClass:"jurisdiction-box"},[e.roleActive?n("el-button",{staticClass:"jurisdiction-edit",attrs:{size:"medium",type:"primary"},on:{click:e.ruleSubmit}},[e._v(" Lưu ")]):e._e(),e._v(" "),n("el-tabs",{model:{value:e.ruleMenuIndex,callback:function(t){e.ruleMenuIndex=t},expression:"ruleMenuIndex"}},e._l(e.ruleMenuList,function(t,i){return n("el-tab-pane",{key:i,attrs:{label:t.label,name:t.index}},["tree"==t.type?n("div",{staticClass:"jurisdiction-content",style:{height:e.treeHeight+"px"}},[n("div",{staticClass:"jurisdiction-content-checkbox"},[n("el-tree",{ref:"tree"+t.index,refInFor:!0,staticStyle:{height:"0"},attrs:{data:t.data,indent:0,"expand-on-click-node":!1,props:e.defaultProps,"show-checkbox":"","node-key":"menuId","empty-text":"","default-expand-all":""}})],1)]):n("div",{staticClass:"jurisdiction-content"},[n("div",{staticClass:"data-radio"},[n("el-radio-group",{model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"item.value"}},[n("el-radio",{attrs:{label:1}},[e._v("Chỉ mình bạn")]),e._v(" "),n("el-radio",{attrs:{label:2}},[e._v("Chỉ bạn và cấp dưới")]),e._v(" "),n("el-radio",{attrs:{label:3}},[e._v("Cả phòng ban")]),e._v(" "),n("el-radio",{attrs:{label:4}},[e._v("Cả phòng ban và các bộ phận liên quan")]),e._v(" "),n("el-radio",{attrs:{label:5}},[e._v("Cả công ty")])],1)],1)])])}))],1)]):e._e()],1)],1)],1),e._v(" "),n("relate-empoyee",{attrs:{visible:e.relateEmpoyeeShow,"role-id":e.roleId},on:{"update:visible":function(t){e.relateEmpoyeeShow=t},save:e.employeesSave}})],1)},[],!1,null,"58b4d5d8",null));u.options.__file="index.vue";t.default=u.exports},MZXp:function(e,t,n){},PG71:function(e,t,n){"use strict";var i=n("iKuw");n.n(i).a},iKuw:function(e,t,n){},mdMS:function(e,t,n){"use strict";var i=n("MZXp");n.n(i).a}}]);